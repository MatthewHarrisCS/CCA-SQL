USE db;
DROP TABLE IF EXISTS EmploymentFX;
DROP TABLE IF EXISTS EmployerFX;
DROP TABLE IF EXISTS PersonFX;

CREATE TABLE PersonFX (
	SSN INT PRIMARY KEY,
    LastName VARCHAR(32) NOT NULL,
    FirstName VARCHAR(32) NOT NULL,
    Gender ENUM('M', 'F', 'X') NOT NULL DEFAULT 'X',
    DateOfBirth DATE NOT NULL,
    DateOfDeath DATE,
    CONSTRAINT ssnCheck CHECK ((SSN > 1000000) AND (SSN < 999999999)),
    CONSTRAINT dateCheck CHECK ((DateOfDeath IS NULL) OR (DateOfBirth < DateOfDeath))
);

CREATE TABLE EmployerFX (
    EmployerName VARCHAR(64) PRIMARY KEY,
    RetirementCode ENUM(
		'DSRS',
		'EMRS',
		'JRS',
		'MPFRS',
		'NRPRS',
		'PERS',
		'SPTA',
		'SPTB',
		'TRS') NOT NULL
);

-- WHOOPS', 'MPFRS'); DROP TABLE EmploymentFX;INSERT INTO EmployerFX VALUES ('DAISY

CREATE TABLE EmploymentFX (
	SSN INT,
    EmployerName VARCHAR(64),
    EmployerFEIN INT,
    DateOfHire DATE NOT NULL,
    DateOfRetire DATE,
    ServiceCredit DOUBLE NOT NULL DEFAULT 0.0,
    PRIMARY KEY(SSN, EmployerName),
	FOREIGN KEY (SSN)
        REFERENCES PersonFX(SSN)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
	FOREIGN KEY (EmployerName)
        REFERENCES EmployerFX(EmployerName)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
	CONSTRAINT feinCheck CHECK((EmployerFEIN > 10000000) AND (EmployerFEIN < 999999999))
);

INSERT INTO PersonFX VALUES (967544068, "Scott", "Michael", 'M', '1966-12-31', '2011-12-31');
INSERT INTO PersonFX VALUES (577170470, "Beasly", "Pam", 'F', '1982-12-31', '2013-08-25');
INSERT INTO PersonFX VALUES (62203368, "Halpert", "Jim", 'M', '1971-07-31', '2013-08-25');
INSERT INTO PersonFX VALUES (128708327, "Schrute", "Dwight", 'M', '1971-07-31', NULL);
INSERT INTO PersonFX VALUES (793113172, "Kapoor", "Kelly", 'F', '1985-02-27', NULL);
INSERT INTO PersonFX VALUES (9437581, "Swanson", "Ron", 'M', '1975-02-27', '2017-01-01');
INSERT INTO PersonFX VALUES (229497251, "Dwyer", "Andy", 'M', '1975-02-27', NULL);
INSERT INTO PersonFX VALUES (49183967, "Knope", "Leslie", 'F', '1985-02-27', '2019-04-14');
INSERT INTO EmployerFX VALUES ("WASHINGTON UNIVERSITY PUBLIC HEALTH FUND", "DSRS");
INSERT INTO EmployerFX VALUES ("MICHAEL SCOTT PAPER COMPANY", "PERS");
INSERT INTO EmployerFX VALUES ("DUNDER MIFFLIN SCRANTON", "EMRS");
INSERT INTO EmployerFX VALUES ("DUNDER MIFFLIN STAMFORD", "EMRS");
INSERT INTO EmployerFX VALUES ("PAWNEE PARKS AND RECREATION DEPARTMENT", "SPTA");
INSERT INTO EmploymentFX VALUES (49183967, "PAWNEE PARKS AND RECREATION DEPARTMENT", 76543210, '1994-04-21', '2001-08-03', 40.7);
INSERT INTO EmploymentFX VALUES (967544068, "DUNDER MIFFLIN SCRANTON", 765456789, '1996-04-21', '2002-08-03', 22.3);
INSERT INTO EmploymentFX VALUES (967544068, "MICHAEL SCOTT PAPER COMPANY", 87656789, '2008-04-21', NULL, 123.3);
INSERT INTO EmploymentFX VALUES (128708327, "DUNDER MIFFLIN SCRANTON", 87654568, '1996-04-21', NULL, 401.2);
SELECT * FROM PersonFX;